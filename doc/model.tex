\section{Model}

\subsection{Preliminaries}

We assume:
\begin{itemize}
\item a set of \emph{memory locations} $\Loc$, ranged over by
  $\aLoc$ and $\bLoc$,
\item a set of \emph{registers} $\Reg$, ranged over by
  $\aReg$ and $\bReg$,
\item a set of \emph{values} $\Val$, ranged over by
  $\aVal$ and $\bVal$,
\item a set of \emph{expressions} $\Exp$, ranged over by
  $\aExp$ and $\bExp$,
\item a set of \emph{logical formulae} $\Formulae$, ranged over by
  $\aForm$ and $\bForm$, and
\item a set of \emph{actions} $\Act$, ranged over by $\aAct$ and $\bAct$,
\end{itemize}
such that:
\begin{itemize}
\item values include at least the constants $0$ and $1$,
\item expressions include at least registers and values,
\item expressions are closed under substitution, written $\aExp[\bExp/\aReg]$,
\item formulae include at least $\TRUE$, $\FALSE$, and equalities of the form $(\aExp=\bExp)$ and $(\aLoc=\bExp)$,
\item formulae are closed under negation, conjunction, disjunction,
\item formulae are closed under substitution, written $\aForm[\bExp/\aLV]$, and
\item actions include at least \emph{reads} of the form $(\DR{\aLoc}{\aVal})$
  and \emph{writes} of the form $(\DW{\aLoc}{\aVal})$.
\end{itemize}
Let the set of \emph{lvalues} be $\LVal=(\Loc\cup\Reg)$, ranged over by $\aLV$ and $\bLV$.

\subsection{Pomsets}

\begin{definition}
  A \emph{pomset} $(\Event, {\le}, \labelling)$ with alphabet $\Alphabet$
  is a partial order $(\Event, {\le})$ together with a function
  $\labelling: \Event \fun \Alphabet$.
\end{definition}
Going forward, we fix the alphabet $\Alphabet=(\Formulae\times\Act)$.
We will write $(\aForm \mid \aAct)$ for the pair $(\aForm,\aAct)$,
$\aAct$ for $(\TRUE,\aAct)$ and $\NEVER\aAct$ for $(\FALSE,\aAct)$.

We visualize a pomset as a graph where the nodes are drawn from
$\Event$, each node $\aEv$ is labelled with $\labelling(\aEv)$,
and an edge $\bEv \rightarrow \aEv$ corresponds to an ordering
$\bEv\le\aEv$. For example:

\[\begin{tikzpicture}[node distance=1em]
  \event{x1}{\DR{\aLoc}{1}}{}
  \nonevent{y0}{\DW{\bLoc}{0}}{below left=of x1}
  \event{y1}{\DW{\bLoc}{1}}{below right=of x1}
  \po{x1}{y0}
  \po{x1}{y1}
\end{tikzpicture}\]
is a visualization of the pomset where:
\[
  0 \le 1 \quad
  0 \le 2 \quad
  \labelling(0) = (\TRUE, \DR{\aLoc}{1}) \quad
  \labelling(1) = (\FALSE, \DW{\bLoc}{0}) \quad
  \labelling(2) = (\TRUE, \DW{\bLoc}{1}) \quad
\]
As we shall see, this is a possible execution of the
program:
\begin{verbatim}
    r := x; if (r) { y := 1; } else { y := 0; }
\end{verbatim}

\subsection{Sets of pomsets}

Let $\aPSS_1 \sqcup \aPSS_2$ be the set $\aPSS_0$ where $\aPS_0 \in \aPSS_0$
whenever there are $\aPS_1 \in \aPSS_1$ and  $\aPS_2 \in \aPSS_2$ such that:
\begin{itemize}
\item $\Event_0 = \Event_1 \cup \Event_2$,
\item if $\aEv \le_1 \bEv$ or $\aEv \le_2 \bEv$ then $\aEv \le_0 \bEv$,
\item if $\labelling_0(\aEv) = (\aForm_0 \mid \aAct)$ then either:
  \begin{itemize}
  \item $\labelling_1(\aEv) = (\aForm_1 \mid \aAct)$ and $\labelling_2(\aEv) = (\aForm_2 \mid \aAct)$
    and $\aForm_0$ implies $\aForm_1 \lor \aForm_2$,
  \item $\labelling_1(\aEv) = (\aForm_1 \mid \aAct)$ and $\aEv \not\in \Event_2$
    and $\aForm_0$ implies $\aForm_1$, or
  \item $\labelling_2(\aEv) = (\aForm_2 \mid \aAct)$ and $\aEv \not\in \Event_1$
    and $\aForm_0$ implies $\aForm_2$.
  \end{itemize}
\end{itemize}
Let $(\phi \mid \DW\aLoc\aVal) \prefix \aPSS$ be the set $\aPSS'$ where $\aPS'\in\aPSS'$ whenever
there is $\aPS\in\aPSS$ such that:
\begin{itemize}
\item $\Event' = \Event \cup \{0\}$,
\item if $\bEv \le \aEv$ then $\bEv \le' \aEv$,
\item $\labelling'(0) = (\aForm, \DW\aLoc\aVal)$, where $\bForm$ implies $\aForm$, and
\item if $\labelling(\aEv) = (\bForm \mid \aAct)$ then $\labelling'(\aEv) = (\bForm \mid \aAct)$.
\end{itemize}
Let $(\phi \mid \DR\aLoc\aVal) \prefix \aPSS$ be the set $\aPSS'$ where $\aPS'\in\aPSS'$ whenever
there is $\aPS\in\aPSS$ such that:
\begin{itemize}
\item $\Event' = \Event \cup \{0\}$,
\item if $\bEv \le \aEv$ then $\bEv \le' \aEv$,
\item $\labelling'(0) = (\bForm, \DR\aLoc\aVal)$, where $\bForm$ implies $\aForm$, and
\item if $\labelling(\aEv) = (\bForm \mid \aAct)$ then
  $\labelling'(\aEv) = (\bForm' \mid \aAct)$,
  $\bForm'$ implies $\bForm[\aVal/\aLoc]$, and
  $0 \le' \aEv$ or $\bForm'$ implies $\bForm$.
\end{itemize}
Let $\aPSS[\aExp/\aLV]$ be the set $\aPSS'$ where $\aPS'\in\aPSS'$ whenever
there is $\aPS\in\aPSS$ such that:
\begin{itemize}
\item $\Event' = \Event$,
\item if $\bEv \le \aEv$ then $\bEv \le' \aEv$, and
\item if $\labelling(\aEv) = (\bForm \mid \aAct)$ then $\labelling'(\aEv) = (\bForm[\aExp/\aLV] \mid \aAct)$.
\end{itemize}
Let $(\aForm \mid \aPSS)$ be the subset of $\aPSS$ such that $\aPS\in\aPSS$ whenever:
\begin{itemize}
\item if $\labelling(\aEv) = (\bForm \mid \aAct)$ then $\aForm$ implies $\bForm$.
\end{itemize}

\subsection{Semantics of programs}

Define:
\begin{eqnarray*}
  \sem{\SKIP} & = & \{ \emptyset \} \\
  \sem{\aLoc\GETS\aExp\SEMI C} & = & \bigcup_\aVal (\aExp=\aVal \mid \DW\aLoc\aVal) \prefix \sem{C}[\aExp/\aLoc] \\
  \sem{\aReg\GETS\aLoc\SEMI C} & = & \bigcup_\aVal (\TRUE \mid \DR\aLoc\aVal) \prefix \sem{C}[\aLoc/\aReg] \\
  \sem{\IF \aExp \THEN C \ELSE D} & = & (\aExp \neq 0 \mid \sem{C}) \sqcup (\aExp=0 \mid \sem{D})
\end{eqnarray*}
